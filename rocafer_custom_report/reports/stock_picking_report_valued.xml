<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="action_stock_picking_report_valued" model="ir.actions.report">
        <field name="name">Delivery Slip</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">rocafer_custom_report.stock_picking_report_valued</field>
        <field name="report_file">rocafer_custom_report.stock_picking_report_valued</field>
        <field name="print_report_name">'Delivery Slip - %s - %s' % (object.partner_id.name or '', object.name)</field>
        <field name="binding_model_id" ref="model_stock_picking"/>
        <field name="binding_type">report</field>
    </record>

    <template id="stock_picking_report_valued"
              inherit_id="stock.report_picking">

        <xpath expr="//div[hasclass('page')]" position="before">
            <t t-set="is_stock_manager" t-value="o.env.user.has_group('stock.group_stock_manager')" />
        </xpath>

        <xpath expr="//table[1]/thead/tr" position="inside">
            <t t-if="o.sale_id and o.move_line_ids and is_stock_manager">
                <th class="text-end"><strong>Unit Price</strong></th>
                <th class="text-end" groups="product.group_discount_per_so_line">
                    <strong>Discount</strong>
                </th>
                <th class="text-end"><strong>Subtotal</strong></th>
                <th class="text-end"><strong>Taxes</strong></th>
            </t>
        </xpath>

        <xpath expr="//table[1]/tbody" position="inside">
            <t t-if="o.sale_id and o.move_line_ids and is_stock_manager">
                <tr>
                    <td class="text-end">
                        <span t-field="o.amount_untaxed" />
                    </td>
                    <td class="text-end">
                        <span t-field="o.amount_tax" />
                    </td>
                    <td class="text-end">
                        <span t-field="o.amount_total" />
                    </td>
                </tr>
            </t>
        </xpath>

        <!--Reemplazar el contenido de la tabla de precios unitarios, descuentos, subtotales y impuestos si el usuario tiene el grupo de stock.manager.-->



<!--        <xpath expr="//table[@class='table table-sm mt32']" position="replace">-->
            <!--        <xpath expr="//t[@t-if='o.valued and o.sale_id and o.move_line_ids and is_outgoing']" position="replace">-->
<!--            <t t-if="o.valued and o.sale_id and o.move_line_ids and o.env.user.has_group('stock.group_stock_manager')">-->
<!--                <table class="table table-sm mt32">-->
<!--                    <thead>-->
<!--                        <tr>-->
<!--                            <th class="text-end">-->
<!--                                <strong>Base imponible</strong>-->
<!--                            </th>-->
<!--                            <th class="text-end">-->
<!--                                <strong>Impuestos</strong>-->
<!--                            </th>-->
<!--                            <th class="text-end">-->
<!--                                <strong>Total</strong>-->
<!--                            </th>-->
<!--                        </tr>-->
<!--                    </thead>-->
<!--                    <tbody>-->
<!--                        <tr>-->
<!--                            <td class="text-end">-->
<!--                                <span t-field="o.amount_untaxed"/>-->
<!--                            </td>-->
<!--                            <td class="text-end">-->
<!--                                <span t-field="o.amount_tax"/>-->
<!--                            </td>-->
<!--                            <td class="text-end">-->
<!--                                <span t-field="o.amount_total"/>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                    </tbody>-->
<!--                </table>-->
<!--            </t>-->
<!--        </xpath>-->
<!--        &lt;!&ndash;        Fin tabla pie&ndash;&gt;-->
<!--        &lt;!&ndash;        Tabla de precios unitarios, descuentos, subtotales y impuestos&ndash;&gt;-->
<!--        <xpath expr="//table[@name='stock_move_line_table']/thead/tr" position="replace">-->
<!--            <th class="text-end">-->
<!--                <strong>Producto</strong>-->
<!--            </th>-->
<!--            <th class="text-end">-->
<!--                <strong>Cantidad</strong>-->
<!--            </th>-->
<!--            <t t-if="o.valued and o.sale_id and o.move_line_ids and o.env.user.has_group('stock.group_stock_manager')">-->
<!--                <th class="text-end">-->
<!--                    <strong>Precio</strong>-->
<!--                </th>-->
<!--                <th class="text-end" groups="product.group_discount_per_so_line">-->
<!--                    <strong>Descuento</strong>-->
<!--                </th>-->
<!--                <th class="text-end">-->
<!--                    <strong>Subtotal</strong>-->
<!--                </th>-->
<!--                <th class="text-end">-->
<!--                    <strong>Impuestos</strong>-->
<!--                </th>-->
<!--            </t>-->
<!--        </xpath>-->
<!--        &lt;!&ndash;*******************************************************************&ndash;&gt;-->

    </template>

<!--    <template id="rocafer_custom_report.valued_report_picking_has_serial_move_line_inherit"-->
<!--              inherit_id="stock_picking_report_valued.valued_report_picking_has_serial_move_line">-->
<!--        <xpath expr="//t[@t-if='o.valued and o.sale_id and o.move_line_ids and is_outgoing']" position="replace">-->
<!--            <t t-if="o.valued and o.sale_id and o.move_line_ids and o.env.user.has_group('stock.group_stock_manager')">-->
<!--                <td class="text-end">-->
<!--                    <span t-field="move_line.sale_price_unit"/>-->
<!--                </td>-->
<!--                <td class="text-end" groups="product.group_discount_per_so_line">-->
<!--                    <span t-field="move_line.sale_discount"/>-->
<!--                </td>-->
<!--                <td class="text-end">-->
<!--                    <span-->
<!--                        t-field="move_line.sale_price_subtotal"-->
<!--                    />-->
<!--                </td>-->
<!--                <td class="text-end">-->
<!--                    <span-->
<!--                        t-field="move_line.sale_tax_description"-->
<!--                    />-->
<!--                </td>-->
<!--            </t>-->
<!--        </xpath>-->
<!--    </template>-->
</odoo>
